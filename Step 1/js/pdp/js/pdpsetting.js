var pdp_setting=jQuery.noConflict();pdp_setting.fn.ForceNumericOnly=function(){return this.each(function(){pdp_setting(this).keydown(function(e){var t=e.charCode||e.keyCode||0;return t==8||t==9||t==46||t>=37&&t<=40||t>=48&&t<=57||t>=96&&t<=105})})};pdp_setting(document).ready(function(e){function t(e){var t=e.split("(");if(t[0]=="rgb"){var n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];e=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);function r(e){return isNaN(e)?"00":n[(e-e%16)/16]+n[e%16]}return"#"+r(e[1])+r(e[2])+r(e[3])}else{return e}}var n=e("#url_site").val().replace("index.php/",""),r,s=[],o=[],u=1e3,a=e("#currency_symbol").val(),f={},l;PDPsetting={add_html:function(){e("body").prepend('<div class="pdploading nodisplay"><span>Please wait...</span></div>');e("body").append('<div style="display:none;" class="nodisplay" id="save_original_img_text"></div><div id="pdp_canvas_result" class="nodisplay"></div>');e("#product-image-wrap").prepend('<img id="main_image" src="'+n+'media/pdp/images/no_image.jpg" />');e(".wrapper_pdp").append(e(".color_content"));e(".wrapper_pdp .wrap_pdp_design").append('<div id="pdp_info_item"><ul></ul></div>');e(".wrapper_pdp .wrap_pdp_design").append('<div id="pdp2_canvas_layer"><canvas id="pdp2_canvas_layer_cv"></canvas></div>')},edit_cart_item:function(e){},center_design_area:function(){e("#main_image").load(function(){var t=e(".wrap_pdp_design").width(),n=e("#main_image").width(),r=parseInt((t-n)/2);e("#product-image-wrap").css("margin-left",r+"px")})},position_color:function(){var t=e("body").width(),n=e(".wrapper_pdp").width(),r=e(".color_content_wrap").width(),i=(t-n)/2-r+n;e(".color_content_wrap").css("left",i+"px")},change_color:function(){e("#pdp_side_items li").each(function(){var t=e(this).attr("tab"),n=e("#pdp_media_url").val(),r=e(".design-color-image li.active").attr(t);e(this).attr("side_img",r).children("img").attr("src",n+r);e(".pdp_info_save[alt="+t+"]").attr("side_img",r)});PDPsetting.change_image()},save_first_design:function(){},handle_files_select:function(t){var n=t.target.files;for(var r=0,i;i=n[r];r++){if(!i.type.match("image.*")){continue}var s=new FileReader;s.onload=function(t){return function(n){var r=e("#lists_img_upload span").length;var i=document.createElement("span");i.innerHTML=['<img id="img_up_'+r++ +'" color="" class="thumb" src="',n.target.result,'" title="',escape(t.name),'"/>'].join("");document.getElementById("lists_img_upload").insertBefore(i,null)}}(i);s.readAsDataURL(i)}e("#files_upload").val("")},change_image:function(){var t=e("#pdp_side_items li.active").attr("side_img"),n=e("#pdp_media_url").val();e("#main_image").attr("src",n+t).load(function(){canvasEvents.renderall()})},change_side:function(){var t=e("#pdp_side_items li.active"),n=t.attr("side_img"),r=t.attr("tab"),i=e("#pdp_info_"+r).val(),s=e("#pdp_media_url").val(),o=t.attr("inlay").split(",");e("#main_image").attr("src",s+n);e("#wrap_inlay").css({width:o[0]+"px",height:o[1]+"px",top:o[2]+"px",left:o[3]+"px"}).show()},display_design_as_html:function(e){},init:function(){function d(e,t,n,r){var i=r/n;if(n>=e&&i<=1){n=e;r=n*i;r*=.9;n*=.9}else if(r>=t){r=t;n=r/i;r*=.9;n*=.9}return{width:n,height:r}}canvasEvents={objectSelected:function(){var t=r.getActiveObject();canvasEvents.showinfo();if(t.text){canvasEvents.changeToEditText(t)}else{canvasEvents.changeToEditItem()}e("#pdp_info_item li.active").removeClass("active");e('#pdp_info_item li[rel="'+t.name+'"]').addClass("active");e("#edit_item_wrap").addClass("active");e("#edit_item_wrap .item:not(#edit_text, #color_item)").css("opacity",1)},removeShadow:function(){var e=r.getActiveObject();if(!e)return;e.setShadow("none");canvasEvents.resetShadowForm();canvasEvents.renderall()},showinfo:function(){var t=r.getActiveObject();if(!t)return;e("#pdp_info_item").show();e("#pdp_info_item ."+t.name+" .item_size").html(parseInt(t.currentWidth)+" x "+parseInt(t.currentHeight))},makelistcolor:function(t,s){if(t!=""&&t!=undefined){t=t.split(",")}else{t=""}e(".pdp_color_list ul").hide();e(".pdp_color_list .pdp_color_png").show();if(e(".pdp_color_list .pdp_color_png").length==0){e(".pdp_color_list").append('<ul class="pdp_color_png"></ul>');e(".pdp_color_png").on("click","a",function(){e(".pdp_color_png .active").removeClass("active");e(this).addClass("active");var t=r.getActiveObject(),i=t.top,s=t.angle,o=t.width,u=t.height,a=t.scaleX,f=t.scaleY,l=t.left,c=t.icolor,h=t.id,p=t.name,d=n+"media/pdp/images/artworks/"+e(this).attr("rel");r.remove(t);fabric.Image.fromURL(d,function(e){e.set({left:l,top:i,angle:s,scaleX:a,scaleY:f,icolor:c,id:h,isrc:d,name:p,width:o,height:u,padding:setting.padding});e.transparentCorners=true;e.cornerSize=10;r.add(e).setActiveObject(e)});r.renderAll()})}for(i=0;i<t.length;i++){var o=t[i].split("__");e(".pdp_color_list ul.pdp_color_png").append('<li alt="'+s+'"><a title="" rel="'+o[1]+'" style="background-color:#'+o[0]+'">'+o[1]+"</a></li>")}if(e("ul.pdp_color_png li:visible").length==0){e(".nomore_color").show()}else{e(".nomore_color").hide()}},addlayer_first_time:function(){var t,n=0;e("#pdp_side_items li").each(function(){var r=JSON.parse(s[e(this).index()]);var i=r.objects,o=0,u=e(this).attr("tab");e(".layer_"+u+" .layer_pricing tbody").html("");for(var f=0;f<i.length;f++){i[f].left=0;i[f].top=0;i[f].angle=0;if(i[f].name!=undefined&&i[f].name!="null"){item_name=i[f].name}else{item_name="item_"+u+f}e("#pdp2_canvas_layer_cv").attr({width:i[f].width*i[f].scaleX,height:i[f].height*i[f].scaleY});var l=new fabric.Canvas("pdp2_canvas_layer_cv",{opacity:1});l.clear();var c=fabric.util.getKlass(i[f].type);if(c.async){c.fromObject(i[f],function(e){l.add(e)})}else{l.add(c.fromObject(i[f]))}if(e("#pdc_product_config").length>0){var h=JSON.parse(e("#pdc_product_config").val());if(i[f].text){if(h.text_price==""){h.text_price=0}if(i[f].price==undefined){i[f].price=h.text_price}}else{if(h.clipart_price==""){h.clipart_price=0}if(i[f].price==undefined){i[f].price=h.clipart_price}}}else{if(i[f].price==undefined){i[f].price=0}}n+=parseFloat(i[f].price);o+=parseFloat(i[f].price);if(i[f].type=="path"||i[f].type=="path-group"||i[f].type=="image"){t='<tr class="pdp2_layer_item" rel="'+item_name+'">'+'<td class="item_type">'+parseInt(f+1)+"</td>"+'<td class="item_info"><img src="'+l.toDataURL("png")+'"/></td>'+'<td class="item_price">'+a+parseFloat(i[f].price).toFixed(2)+"</td>"+'<td><a class="item_delete" title="Remove"><i class="pi pi-trash-o"></i></a></td></tr>'}if(i[f].type=="text"){t='<tr class="pdp2_layer_item" rel="'+item_name+'">'+'<td class="item_type">'+parseInt(f+1)+"</td>"+'<td class="item_info">'+i[f].text.substring(0,15)+"...</td>"+'<td class="item_price">'+a+parseFloat(i[f].price).toFixed(2)+"</td>"+'<td><a class="item_delete" title="Remove"><i class="pi pi-trash-o"></i></a></td></tr>'}e(".layer_"+u+" tbody").append(t).parents(".layer_pricing").attr("pr",o)}});e("#pdp_total_layer_price tfoot tr th:eq(2)").html(a+n.toFixed(2));e(".item_delete").parent().remove();var r=e("#pdp_side_items li.active").attr("tab")},update_total_price_layer:function(){var t=0;e(".prices_layer").each(function(){var n=e(this).find(".layer_pricing").attr("pr");if(n==undefined){n=0}t+=parseFloat(n)});e(".item_delete").parent().remove();e("#pdp_total_layer_price .layer_pricing").attr("pr",t.toFixed(2));e("#pdp_total_layer_price .layer_pricing th:eq(2)").html(a+t.toFixed(2))},addlayer:function(){var t,n=0;var r=JSON.parse(s[e("#pdp_side_items li.active").index()]);var i=r.objects,o=e("#pdp_side_items li.active").attr("tab");e(".layer_"+o+" .layer_pricing tbody").html("");e(".layer_"+o+" tbody").append(t).parents(".layer_pricing").attr("pr",n);for(var u=0;u<i.length;u++){i[u].left=0;i[u].top=0;i[u].angle=0;if(i[u].name!=undefined){item_name=i[u].name}else{item_name="item_"+u}e("#pdp2_canvas_layer_cv").attr({width:i[u].width*i[u].scaleX,height:i[u].height*i[u].scaleY});var f=new fabric.Canvas("pdp2_canvas_layer_cv",{opacity:1});f.clear();var l=fabric.util.getKlass(i[u].type);if(l.async){l.fromObject(i[u],function(e){f.add(e)})}else{f.add(l.fromObject(i[u]))}if(e("#pdc_product_config").length>0){var c=JSON.parse(e("#pdc_product_config").val());if(i[u].text){if(c.text_price==""){c.text_price=0}if(i[u].price==undefined){i[u].price=c.text_price}}else{if(c.clipart_price==""){c.clipart_price=0}if(i[u].price==undefined){i[u].price=c.clipart_price}}}else{if(i[u].price==undefined){i[u].price=0}}n+=parseFloat(i[u].price);if(i[u].type=="path"||i[u].type=="path-group"){t='<tr class="pdp2_layer_item" rel="'+item_name+'">'+'<td class="item_type">'+parseInt(u+1)+"</td>"+'<td class="item_info"><img src="'+f.toDataURL("png")+'"/></td>'+'<td class="item_price">'+a+parseFloat(i[u].price).toFixed(2)+"</td>"+'<td><a class="item_delete" title="Remove"><i class="pi pi-trash-o"></i></a></td></tr>'}if(i[u].type=="image"){t='<tr class="pdp2_layer_item" rel="'+item_name+'">'+'<td class="item_type">'+parseInt(u+1)+"</td>"+'<td class="item_info"><img src="'+i[u].isrc+'"/></td>'+'<td class="item_price">'+a+parseFloat(i[u].price).toFixed(2)+"</td>"+'<td><a class="item_delete" title="Remove"><i class="pi pi-trash-o"></i></a></td></tr>'}if(i[u].type=="text"){t='<tr class="pdp2_layer_item" rel="'+item_name+'">'+'<td class="item_type">'+parseInt(u+1)+"</td>"+'<td class="item_info">'+i[u].text.substring(0,15)+"...</td>"+'<td class="item_price">'+a+parseFloat(i[u].price).toFixed(2)+"</td>"+'<td><a class="item_delete" title="Remove"><i class="pi pi-trash-o"></i></a></td></tr>'}e(".layer_"+o+" tbody").append(t).parents(".layer_pricing").attr("pr",n)}canvasEvents.update_total_price_layer()},activeobj:function(e){var t=r.getObjects();if(e!=""&&e!=undefined){for(var n=0;n<t.length;n++){if(t[n].name==e){r.setActiveObject(t[n])}}}},resetShadowForm:function(){e("#use_shadow").removeClass("active");e("#h-shadow").val(0);e("#v-shadow").val(0);e("#t-blur").val(0);e("#font_outline_color_value").css({"background-color":"#FFF",color:"#000"}).val("#FFFFFF");e(".font_outline_color > div:not(.use_shadow)").hide()},addShadowItem:function(){var t=r.getActiveObject();if(!t)return;setting_shadow={h_shadow:e("#h-shadow").val(),v_shadow:e("#v-shadow").val(),blur:e("#t-blur").val(),color:e("#font_outline_color_value").val()};t.setShadow({color:setting_shadow.color,blur:setting_shadow.blur,offsetX:setting_shadow.v_shadow,offsetY:setting_shadow.h_shadow});canvasEvents.renderall()},renderall:function(){r.selection=false;canvasEvents.save_history();canvasEvents.save_design2();r.calcOffset().renderAll();canvasEvents.addlayer()},reset_canvas:function(t){var i=e("#pdp_side_items li[tab="+t+"]"),o,u=e("#pdp_side_items li[tab="+t+"]").index(),a;if(i.length>0){o=n+"media/pdp/images/"+i.attr("side_img");e("#main_image").attr("src",o);a=i.attr("inlay").split(",");e("#wrap_inlay").html('<canvas id="canvas_area"></canvas>');e("#wrap_inlay").css({width:a[0]+"px",height:a[1]+"px",top:a[2]+"px",left:a[3]+"px"});e("#canvas_area").attr({width:a[0],height:a[1]});r=new fabric.Canvas("canvas_area",{});r.clear();r.observe("object:selected",canvasEvents.objectSelected);r.observe("object:modified",canvasEvents.renderall);r.observe("object:modified",canvasEvents.showinfo);r.observe("object:added",canvasEvents.renderall);r.observe("before:selection:cleared",canvasEvents.objectUnselected);canvasEvents.load_json(s[u]);canvasEvents.centerCanvas();canvasEvents.renderall()}},save_history:function(){var t=e("#pdp_side_items li.active").index();s[t]=JSON.stringify(r.toJSON(["name","price","tcolor","isrc","icolor","id"]))},editShadowItem:function(){var t=r.getActiveObject();if(!t)return;var n=t.get("shadow");if(n!=null&&n.color!="none"){setting_shadow={h_shadow:e("#h-shadow").val(),v_shadow:e("#v-shadow").val(),blur:e("#t-blur").val(),color:e("#font_outline_color_value").val()};t.setShadow({color:setting_shadow.color,blur:setting_shadow.blur,offsetX:setting_shadow.v_shadow,offsetY:setting_shadow.h_shadow})}else{canvasEvents.resetShadowForm()}r.calcOffset().renderAll()},changeToEditItem:function(){var t=r.getActiveObject();if(!t)return;var n=t.get("opacity");e("#pdp_opacity_input").val(n*10);var i=t.get("shadow");if(t.tcolor==1){e(".pdp_color_list ul.mCustomScrollbar").show();e(".pdp_color_list ul").show();e(".pdp_color_list ul.pdp_color_png").hide();e(".nomore_color").hide()}else{var s=t.isrc.split("/");e(".pdp_color_list ul.mCustomScrollbar").hide();e(".pdp_color_list ul").hide();e(".pdp_color_list ul.pdp_color_png").show();e(".pdp_color_png a.active").removeClass("active");e('.pdp_color_png a[rel="'+s[s.length-1]+'"]').addClass("active");e(".pdp_color_png li").hide();if(t.icolor!=""&&t.icolor!=undefined&&e('.pdp_color_png li[alt="'+t.id+'"]').length==0){canvasEvents.makelistcolor(t.icolor,t.id)}e('.pdp_color_png li[alt="'+t.id+'"]').show();if(e("ul.pdp_color_png li:visible").length==0){e(".nomore_color").show()}else{e(".nomore_color").hide()}}if(i==null||i.color=="none"){canvasEvents.resetShadowForm()}else{e(".font_outline_color > div:not(.use_shadow)").show();e("#h-shadow").val(i.offsetY);e("#v-shadow").val(i.offsetX);e("#t-blur").val(i.blur);e("#font_outline_color_value").val(i.color).css("background-color",i.color);e("#use_shadow").addClass("active")}},change_main_image:function(){var t=e("#pdp_side_items li.active").attr("tab"),n=e(".pdp_design_color li.active").attr(t),r=e("#pdp_media_url").val();e("#main_image").attr("src",r+n)},editText:function(){var t=r.getActiveObject();if(!t)return;if(!t.text)return;if(t.type!="curvedText"){t.setText(e("#pdp_edit_text_input").val());if(e("#pdp_edit_text_input").val()!=""){t.setText(e("#pdp_edit_text_input").val())}else{e("#edit_text").css("opacity","0.5");canvasEvents.removeObject()}}e("#edit_item_wrap").show();e("#edit_text").css("opacity","1");e("#font_outline_colorpicker").hide();var n=e("#font_color").css("color"),i=e("#select_font li.active").attr("rel"),s=e("#pdp_edit_text_line_height_input").val()/10,o,u,a,f=t.get("left"),l=t.get("top"),c=e("#pdp_font_size_input").val(),h="";if(e(".pdp_edit_font_style .bold").hasClass("active")){o="bold"}else{o=""}console.log(n);if(e(".pdp_edit_font_style .italic").hasClass("active")){u="italic"}else{u=""}if(e(".pdp_edit_font_style .underline").hasClass("active")){h+=" underline "}if(e(".pdp_edit_font_style .overline").hasClass("active")){h+=" overline "}if(e(".pdp_edit_font_style .line-through").hasClass("active")){h+=" line-through "}if(e("#pdp_edit_text_style .align.align_left").hasClass("active")){a="left"}if(e("#pdp_edit_text_style .align.align_right").hasClass("active")){a="right"}if(e("#pdp_edit_text_style .align.align_center").hasClass("active")){a="center"}t.set({fill:n,fontSize:c,fontStyle:u,fontWeight:o,textDecoration:h,fontFamily:i,lineHeight:s,textAlign:a});if(e("#use_shadow").hasClass("active")){setting_shadow={h_shadow:e("#h-shadow").val(),v_shadow:e("#v-shadow").val(),blur:e("#t-blur").val(),color:e("#font_outline_color_value").val()};t.setShadow({color:setting_shadow.color,blur:setting_shadow.blur,offsetX:setting_shadow.v_shadow,offsetY:setting_shadow.h_shadow})}else{canvasEvents.resetShadowForm();t.setShadow("none")}canvasEvents.renderall()},addText:function(t){e("#add_text").slideUp(300);e("#add_text_input").val("");e("#edit_text").css("opacity","1");e("#color_item").css("opacity",.5);var n=e("#font_color").css("color"),i="Arial",s,o,u="",a=parseInt(e("#pdp_info_item").attr("critem"));n="#111";e("#pdp_info_item").attr("critem",a+1);var f={};f.text_price=0;if(e("#pdc_product_config").length){f=JSON.parse(e("#pdc_product_config").val())}var l=r.getCenter(),c=new fabric.Text(t,{fontFamily:i,left:l.left,top:l.top,fontSize:20,textAlign:"left",fill:n,price:f.text_price,name:"item_"+a,lineHeight:"1.3",fontStyle:"",fontWeight:"normal",textDecoration:"",shadow:"",padding:setting.padding});c.lockUniScaling=false;c.hasRotatingPoint=true;c.transparentCorners=true;c.cornerColor=setting.border;r.add(c).setActiveObject(c);canvasEvents.center();canvasEvents.addlayer();e("#use_shadow").click();canvasEvents.renderall()},addTextCurved:function(t){e("#add_text").slideUp(300);e("#add_text_input").val("");e("#edit_text").css("opacity","1");e("#color_item").css("opacity",.5);var n="#111",i="Arial",s,o,u="";var a=r.getCenter(),f=new fabric.CurvedText(t,{left:a.left,top:a.top,fontFamily:i,textAlign:"left",fill:n,radius:100,perPixelTargetFind:true,fontSize:20,spacing:15,lockUniScaling:true});f.lockUniScaling=true;f.hasRotatingPoint=true;f.transparentCorners=true;f.cornerColor=setting.border;r.add(f).setActiveObject(f);canvasEvents.center();canvasEvents.renderall()},editCurvedText:function(e){canvasEvents.renderall()},changeToEditText:function(n){e("#tab_text").prop("checked",true);e('a[tab="pdp_edit_text_curved"]').hide();if(!n)return false;e("#pdp_edit_text_input").val(n.getText());var r=n.get("fontFamily"),i=n.get("fontSize"),s=n.get("textDecoration"),o=n.get("fontStyle"),u=n.get("textAlign"),a=n.get("fontWeight"),f=n.get("fill"),l=n.get("opacity"),c=n.get("lineHeight"),h=n.get("shadow");e("#font_color").css("color",f);e("#font_color_colorpicker_value").css("background-color",f);e("#font_color_colorpicker_value").val(t(f));if(h&&h!=""&&h.color!="none"){e(".font_outline_color > div").show();e("#use_shadow").addClass("active");e("#h-shadow").val(h.offsetY);e("#v-shadow").val(h.offsetX);e("#t-blur").val(h.blur);e("#font_outline_color_value").val(h.color).css("background-color",h.color)}else{canvasEvents.resetShadowForm()}e("#pdp_opacity_input").val(l*10);e(".pdp_edit_text_tab_content").hide();if(n.get("type")=="curvedText"){e("#pdp2_curved_text").val(n.getText());e("#pdp_edit_text_tab a.active").removeClass("active");e("#pdp_edit_text_tab_content, a[tab=pdp_edit_text_tab_content]").hide();e(".pdp_curved_text_control").show();e('a[tab="pdp_edit_text_curved"], #pdp_edit_text_curved').addClass("active").show()}else{e('a[tab="pdp_edit_text_tab_content"]').addClass("active").show();e('#pdp_edit_text_tab a[tab!="pdp_edit_text_curved"], #pdp_edit_text_tab_content').show()}e(".pdp_edit_font_style a, #pdp_edit_text_style a").removeClass("active");e("#pdp_font_size_value").html(i+"px");e("#pdp_font_line_height_value").html(c);if(u=="right"){e("#pdp_edit_text_style .align_right").addClass("active")}else{if(u=="center"){e("#pdp_edit_text_style .align_center").addClass("active")}else{e("#pdp_edit_text_style .align_left").addClass("active")}}if(a=="bold"){e(".pdp_edit_font_style .bold").addClass("active")}if(o=="italic"){e(".pdp_edit_font_style .italic").addClass("active")}if(s.indexOf("underline")>0){e(".pdp_edit_font_style .underline").addClass("active")}if(s.indexOf("overline")>0){e(".pdp_edit_font_style .overline").addClass("active")}if(s.indexOf("line-through")>0){e(".pdp_edit_font_style .line-through").addClass("active")}e("#pdp_color").css("color","#111");if(f=="#111"){e("#pdp_color_text li:eq(0) a").addClass("active")}else{e("#pdp_color_text li a").each(function(){})}e("#pdp_color_text_input").css("background-color",f);e("#select_font li").removeClass("active");e('#select_font li[rel="'+r+'"]').addClass("active");e("#pdp_edit_text_line_height_input").val(c*10);e("#pdp_font_line_height_value").html(parseInt(c*10)+"px");e("#pdp_font_size_input").val(i);if(n.type=="curvedText"){e("#use_curved").addClass("active");e(".pdp_curved_text_control").show()}else{e("#use_curved").removeClass("active");e(".pdp_curved_text_control").hide()}},addSvg:function(t,n,i,s,o,u){fabric.loadSVGFromURL(t,function(a,f){var l=fabric.util.groupSVGElements(a,f),c=r.getCenter(),h=parseInt(e("#pdp_info_item").attr("critem"));e("#pdp_info_item").attr("critem",h+1);if(n==""||n==undefined){n=0}if(i==""||i==undefined){i="not_add"}l.set({perPixelTargetFind:true,isrc:t,price:n,tcolor:s,icolor:o,name:i,id:u,fill:setting.color,transparentCorners:true,padding:setting.padding});if(l.width>r.width){l.scaleToWidth(r.width-20)}l.setCoords();r.centerObject(l);l.hasRotatingPoint=true;l.lockUniScaling=true;r.add(l).setActiveObject(l);canvasEvents.addlayer()})},resetTextForm:function(){e("#pdp_font_size_input").val(20);e("#pdp_font_size_value").html("20px");e("#pdp_edit_text_line_height_input").val(13);e("#pdp_font_line_height_value").html("13px");e("#use_shadow").attr("checked",false);e("#add_text_action").show();e("#edit_text_action, .pdp_edit_text_tab_content").hide();e("#edit_text").css("opacity",.5);e("#add_text_input").val("");e("#select_font_span").html("Arial").css("font-family","Arial");e("#pdp_edit_text_tab_content").show();e("#pdp_color_text input").val("#111111");e("#font_outline_colorpicker").setColor("#FFFFFF");e("#pdp_edit_text .active, #pdp_edit_text_style .active").removeClass("active");e("#pdp_edit_text_tab a:eq(0),#pdp_edit_text_style .align_left").addClass("active");e("#select_font li").removeClass("active");e("#select_font li:eq(0)").addClass("active");e("#use_curved").removeClass("active");e(".pdp_curved_text_control").hide()},objectUnselected:function(){e("#pdp_info_item li.active").removeClass("active");e(".pdp_extra_item, .tab_content:not(#pdp_rotate_item), #font_outline_colorpicker").slideUp(400);e("#edit_item_wrap .active").removeClass("active");e("#edit_item_wrap").removeClass("active");e("#edit_item_wrap div.item").css("opacity",.5)},clearSelected:function(){this.objectUnselected();r.deactivateAll().renderAll()},centerX:function(){var e=r.getActiveObject();if(!e)return;r.centerObjectH(e);e.setCoords();canvasEvents.renderall()},center:function(){var e=r.getActiveObject();if(!e)return;r.centerObjectH(e);r.centerObjectV(e);e.setCoords();canvasEvents.renderall()},centerY:function(){var e=r.getActiveObject();if(!e)return;r.centerObjectV(e);e.setCoords();canvasEvents.renderall()},rotateRight:function(e){var t=e.getActiveObject();if(!t)return;var n=t.get("angle");t.rotate(n+45);t.setCoords();canvasEvents.renderall()},rotateLeft:function(e){var t=e.getActiveObject();if(!t)return;var n=t.get("angle");t.rotate(n-45);t.setCoords();canvasEvents.renderall()},flipX:function(){var e=r.getActiveObject();if(!e)return;e.flipX=e.flipX?false:true;e.setCoords();canvasEvents.renderall()},flipY:function(){var e=r.getActiveObject();if(!e)return;e.flipY=e.flipY?false:true;e.setCoords();canvasEvents.renderall()},load_json:function(t){var n=JSON.parse(t);var i=n.objects;r.clear();e("#pdp_info_item").attr("critem",i.length);var s=false;i.forEach(function(e){if(e.type=="text"){s=true;return}});if(!e(".pdp_side_item_content.active.first-loaded").length&&s){var o=new fabric.Text("Loading...",{left:0,top:0,fontSize:25,shadow:"rgba(0,0,0,0.3) 5px 5px 5px",fontFamily:"Impact",stroke:"#fff",strokeWidth:1});setTimeout(function(){r.remove(o);canvasEvents.renderall();e(".pdp_side_item_content.active").addClass("first-loaded")},u)}fabric.util.enlivenObjects(i,function(e){var t=r.renderOnAddRemove;r.renderOnAddRemove=false;e.forEach(function(e){r.add(e)});r.renderOnAddRemove=t;r.renderAll()})},copyObject:function(){var e=r.getActiveObject();if(!e)return;if(fabric.util.getKlass(e.type).async){e.clone(function(e){e.set({transparentCorners:true,cornerColor:setting.border});r.add(e)})}else{r.add(e.clone().set({transparentCorners:true,cornerColor:setting.border}))}canvasEvents.addlayer();canvasEvents.renderall()},removeObject:function(){var t=r.getActiveObject();if(t){e('#pdp_info_item li[rel="'+t.name+'"]').remove();r.remove(t);canvasEvents.renderall()}},moveObject:function(e){var t=r.getActiveObject();if(t){if(e=="up"){t.setTop(t.getTop()-1).setCoords();canvasEvents.renderall()}else if(e=="down"){t.setTop(t.getTop()+1).setCoords();canvasEvents.renderall()}else if(e=="left"){t.setLeft(t.getLeft()-1).setCoords();canvasEvents.renderall()}else if(e=="right"){t.setLeft(t.getLeft()+1).setCoords();canvasEvents.renderall()}}},applyFilter:function(e,t){var n=r.getActiveObject();n.filters[e]=t;n.applyFilters(r.renderAll.bind(r))},changeTextColor:function(e){var t=r.getActiveObject();if(!t)return;if(t.text||t.type=="path"){if(e=="transparent"){t.set("fill","#FFF")}else{t.set("fill",e)}r.renderAll()}},changeColor:function(e){var t=r.getActiveObject();if(!t)return;if(t.text||t.type=="path"){if(e=="transparent"){t.set("fill","#FFF")}else{t.set("fill",e)}}else{if(e=="transparent"){t.set("fill","#111")}else{t.set("fill",e)}}canvasEvents.renderall()},save_png:function(t,n,r){if(!fabric.Canvas.supports("toDataURL")){alert("This browser doesn't provide means to serialize canvas to an image")}else{canvasEvents.clearSelected();var i=n.split(",");e("#pdp_result_2").html('<canvas id="canvas_export_2"></canvas>');e("#canvas_export_2").attr({width:i[0],height:i[1]});var o=new fabric.Canvas("canvas_export_2",{opacity:1});var u=JSON.parse(s[r]);var a=u.objects;for(var f=0;f<a.length;f++){var l=fabric.util.getKlass(a[f].type);if(l.async){l.fromObject(a[f],function(e){o.add(e)})}else{o.add(l.fromObject(a[f]))}}o.renderAll();e("#pdp_canvas_result").html('<canvas id="canvas_export"></canvas>');e("#canvas_export").attr({width:i[4],height:i[5]});var c=new fabric.Canvas("canvas_export",{opacity:1});c.setBackgroundImage(t,c.renderAll.bind(c));fabric.Image.fromURL(o.toDataURL("png"),function(e){e.set({left:parseFloat(i[3]),top:parseFloat(i[2]),width:i[0],height:i[1],angle:0,selectable:false});e.transparentCorners=true;e.cornerSize=10;e.scale(1).setCoords();c.add(e)});c.renderAll();e("#pdp_canvas_result").animate({opacity:1},600,function(){e("#pdp_side_items li:eq("+r+")").children("img").attr("src",c.toDataURL("png"))})}},isRenderFinished:function(){if(e("#pdp_side_items li.rendered").length==e("#pdp_side_items li").length){clearTimeout(l);canvasEvents.actionAfterRendered();return}l=setTimeout(canvasEvents.isRenderFinished,u)},resetBeforeRender:function(){e("#pdp_side_items li").removeClass("rendered")},actionAfterRendered:function(){var t=e("#temp_action").val();switch(t){case"SAVE_ADMIN_TEMPLATE":canvasEvents.saveJsonFileAndImage();break;case"PREVIEW":e("#pdp2_zoom_content").remove();e("#pdp_design_popup").append('<div id="pdp2_zoom_content"><span class="inlay"></span><div id="pdp2_zoom_img"><img src="'+e("#pdp_side_items li.active img").attr("src")+'" /><span class="close"></span></div></div>');e("body").on("click","#pdp2_zoom_content .close",function(){e("#pdp2_zoom_content").hide()});e("#pdp2_zoom_img img").attr("src",e("#pdp_side_items li.active img").attr("src"));e("#pdp2_zoom_content").show();e(".pdploading").hide();break;case"SHARE":canvasEvents.saveJsonBeforeShare();break;case"DOWNLOAD":e("#pdp2_zoom_content").remove();e("#pdp_design_popup").append('<div id="pdp2_zoom_content"><span class="inlay"></span><div id="pdp2_zoom_img"><img src="'+e("#pdp_side_items li.active img").attr("src")+'" /><a id="export_image" href="">Press this button to download and close</a></div></div>');e("#pdp2_zoom_img img").attr("src",e("#pdp_side_items li.active img").attr("src"));e("#pdp2_zoom_content").show();e("#export_image").attr("href",e("#pdp_side_items .active img").attr("src"));var n="Customize-product-"+e("#current_product_id").val()+"-"+e("#pdp_side_items .active").attr("id")+".png";e("#export_image").attr("download",n);if(e("#is_backend").length){e("#pdp2_zoom_content_backend").remove();e("body").append("<div id='pdp2_zoom_content_backend'></div>");e("#pdp2_zoom_content_backend").html(e("#pdp2_zoom_content").parent().html())}e("body").on("click","#export_image",function(){e("#pdp2_zoom_content").hide();e("#pdp2_zoom_content_backend").html("")});e(".pdploading").hide();break;default:console.log("Current Action"+t,"Do nothing");break}},save_design2:function(t){if(t!==true){return false}var r="";if(!fabric.Canvas.supports("toDataURL")){alert("This browser doesn't provide means to serialize canvas to an image")}else{canvasEvents.resetBeforeRender();f={};var i;e("#pdp_side_items li").each(function(t,r){i=JSON.parse(s[t]);var o=document.getElementById("thumbnail_"+this.id.replace("side_",""));f[this.id]={temp_canvas:null,final_canvas:null,json:i,background:n+"media/pdp/images/"+e(this).attr("side_img"),inlay_info:e(this).attr("inlay").split(","),final_canvas_width:o.naturalWidth,final_canvas_height:o.naturalHeight};canvasEvents.renderSide(e(this),this.id,u)});l=setTimeout(canvasEvents.isRenderFinished,u)}},renderSide:function(t,n,r){e(".pdploading").show();e("#temp_canvas_"+n).remove();e("#final_canvas_"+n).remove();e("#pdp_canvas_result").append('<canvas id="temp_canvas_'+n+'"></canvas><canvas id="final_canvas_'+n+'"></canvas>');e("#final_canvas_"+n).attr({width:f[n]["final_canvas_width"],height:f[n]["final_canvas_height"]});e("#temp_canvas_"+n).attr({width:f[n]["inlay_info"][0],height:f[n]["inlay_info"][1]});f[n]["final_canvas"]=new fabric.Canvas("final_canvas_"+n,{opacity:1});f[n]["temp_canvas"]=new fabric.Canvas("temp_canvas_"+n,{opacity:1});f[n]["final_canvas"].setBackgroundImage(f[n]["background"],f[n]["final_canvas"].renderAll.bind(f[n]["final_canvas"]));var i=f[n]["json"].objects;fabric.util.enlivenObjects(i,function(e){var t=f[n]["temp_canvas"].renderOnAddRemove;f[n]["temp_canvas"].renderOnAddRemove=false;f[n]["temp_canvas"].stateful=false;e.forEach(function(e){f[n]["temp_canvas"].add(e)});f[n]["temp_canvas"].renderOnAddRemove=t});f[n]["temp_canvas"].renderAll();setTimeout(function(){fabric.Image.fromURL(f[n]["temp_canvas"].toDataURL("png"),function(e){e.set({left:parseFloat(f[n]["inlay_info"][3]),top:parseFloat(f[n]["inlay_info"][2]),width:f[n]["inlay_info"][0],height:f[n]["inlay_info"][1],angle:0,selectable:false});e.transparentCorners=true;e.cornerSize=10;e.scale(1).setCoords();f[n]["final_canvas"].renderOnAddRemove=false;f[n]["final_canvas"].stateful=false;f[n]["final_canvas"].add(e);f[n]["final_canvas"].renderAll();t.children("img").attr("src",f[n]["final_canvas"].toDataURL("png"));t.addClass("rendered")})},u)},saveJsonFileAndImage:function(){canvasEvents.clearSelected();var t=e("#skin_url").val(),r=e("#base_dir").val(),i=0;mitem=parseInt(e("#pdp_side_items li").length),dt={items:[]};var o=new Array;e("#pdp_side_items li").each(function(){var t=e(this).index(),i=e(this).children("img").attr("src"),s=i.split(":");if(s[0]=="data"){var u={base_dir:r,data:i,index:t},a=n+"js/pdp/saveanimage.php",f=PDPAction.deferredRequest(a,u,function(t){var n=JSON.parse(t);e("#pdp_side_items li:eq("+n.index+")").children("img").attr("src",n.path)});o.push(f)}});e.when.apply(null,o).done(function(){e("#pdp_side_items li").each(function(){item={side_name:e(this).attr("label"),side_img:e(this).attr("side_img"),json:s[e(this).index()],image_result:e(this).find("img").attr("src"),final_price:e("#pdp_total_layer_price .layer_pricing").attr("pr")};dt.items.push(item)});var t=n+"index.php/pdp/index/saveJsonfile";var r=JSON.stringify(dt);if(r!=""){var i=true;try{var o=JSON.parse(r)}catch(u){i=false}if(i){var a=false;if(e("#is_backend").length){a=true}var f=PDPAction.deferredRequest(t,{json_file:r},function(t){var n=e.parseJSON(t);e("input[name='extra_options']").val(n.filename)});e.when(f).done(function(t){e(".pdploading").hide();if(!a){e("#pdp_design_popup").hide(500);e(".product-view .product-img-box .product-image img").attr("src",e("#pdp_side_items li:eq(0)").children("img").attr("src"));e(".product-view .product-img-box .product-image").append('<span class="loadinggif"></span>');e(".product-view .product-img-box .product-image img").load(function(){e(".product-view .product-img-box .product-image .loadinggif").remove()});if(mitem>1){e(".more-views").remove();if(e(".product-view .product-img-box .pdp_more_view").length==0){e(".product-view .product-img-box").append('<div class="more-views"><h2>More View</h2><ul class="pdp_more_view"></ul></div>')}else{e(".pdp_more_view").html("")}}e("#pdp_side_items li").each(function(){e(".pdp_more_view").append('<li><img class="pdp-thumb" width="56" height="56" src="'+e(this).find("img").attr("src")+'" /></li>')});e(".pdp_more_view li img").click(function(){e(".product-view .product-img-box .product-image img").attr("src",e(this).attr("src"))});if(e("#product_price_config").length){var n=JSON.parse(e("#product_price_config").val());var r=parseFloat(e("#pdp_total_layer_price .layer_pricing").attr("pr"));n.productPrice=n.productPrice+r;n.productOldPrice=n.productOldPrice+r;optionsPrice=new Product.OptionsPrice(n);try{optionsPrice.reload()}catch(i){console.log(i)}}}else{var s=e("#url_site").val()+"pdp/index/saveAdminTemplate",o=e("#current_product_id").val(),u={product_id:o,pdp_design:e("input[name='extra_options']").val()};PDPAction.doRequest(s,u,function(t){if(window.top.Windows!==undefined){window.top.Windows.closeAll()}else{e(".pdploading").hide()}})}})}}})},saveJsonBeforeShare:function(){canvasEvents.clearSelected();var t=e("#skin_url").val(),r=e("#base_dir").val(),i=0;mitem=parseInt(e("#pdp_side_items li").length),price=e("#pdp_total_layer_price .layer_pricing").attr("pr"),dt={items:[]};var o=new Array;e("#pdp_side_items li").each(function(){var t=e(this).index(),i=e(this).children("img").attr("src"),s=i.split(":");if(s[0]=="data"){var u={base_dir:r,data:i,index:t},a=n+"js/pdp/saveanimage.php",f=PDPAction.deferredRequest(a,u,function(t){var n=JSON.parse(t);e("#pdp_side_items li:eq("+n.index+")").children("img").attr("src",n.path)});o.push(f)}});e.when.apply(null,o).done(function(){e("#pdp_side_items li").each(function(){item={side_name:e(this).attr("label"),side_img:e(this).attr("side_img"),json:s[e(this).index()],image_result:e(this).find("img").attr("src")};dt.items.push(item)});var t=n+"index.php/pdp/index/saveJsonfile";var r=JSON.stringify(dt);if(r!=""){var i=true;try{var o=JSON.parse(r)}catch(u){i=false}if(i){var a=PDPAction.deferredRequest(t,{json_file:r},function(t){var n=e.parseJSON(t);e("input[name='share_json']").val(n.filename)});e.when(a).done(function(t){e(".pdploading").hide();var n=e("#save_design_url").val(),r=e("#current_product_id").val(),i={product_id:r,pdpdesign:e("input[name='share_json']").val(),url:e("#product_url").val()};PDPAction.doRequest(n,i,function(t){var n=e.parseJSON(t);var r=e.parseJSON(n.final_images);e(".pinterest-share-thumbnail").html("");if(r.length){e.each(r,function(t,n){console.log(n);var r='<img src="'+n.image+'"/>';e(".pinterest-share-thumbnail").append(r)})}for(var i=0;i<addthis.links.length;i++){addthis.links[i].share.url=n.url}var s={image_container:".pinterest-share-thumbnail"};e(".pdploading").hide();e(".pdp_share_buttons").animate({height:"55px"},"fast");setTimeout(function(){e(".pdp_share_buttons").css({opacity:"1"})},700);e(".pdp_share_buttons").slideToggle("fast")})})}}})},save_design:function(t,i,s){e("#save_design").addClass("loading");var o="";if(!fabric.Canvas.supports("toDataURL")){alert("This browser doesn't provide means to serialize canvas to an image")}else{var u=n+"media/pdp/images/"+e("#pdp_side_items li:eq("+t+")").attr("side_img"),a=e("#pdp_side_items li:eq("+t+")").attr("inlay");canvasEvents.clearSelected();var f=a.split(",");e("#pdp_canvas_result").html('<canvas id="canvas_export"></canvas>');e("#canvas_export").attr({width:i,height:s});var l=new fabric.Canvas("canvas_export",{opacity:1});l.setBackgroundImage(u,l.renderAll.bind(l));fabric.Image.fromURL(r.toDataURL("png"),function(e){e.set({left:parseFloat(f[3]),top:parseFloat(f[2]),width:f[0],height:f[1],angle:0,selectable:false});e.transparentCorners=true;e.cornerSize=10;e.scale(1).setCoords();l.add(e)});l.renderAll();e("#pdp_result").animate({opacity:1},600,function(){e("#save_design").removeClass("loading");e("#pdp_side_items li:eq("+t+")").children("img").attr("src",l.toDataURL("png"));e("#pdp_result").html("")})}},save_design_json:function(){var t={title:e(".product-title").html(),sides:[]};e("#pdp_side_items li").each(function(){var n={label:e(this).attr("label"),inlay:e(this).attr("inlay"),img:e(this).attr("side_img"),thumnail:e(this).children("img").attr("src"),canvas:s[e(this).index()]};t.sides.push(n)});return JSON.stringify(t)},saveSampleDesign:function(){e("#save_sample_design").click(function(){var t=canvasEvents.save_design_json();e.ajax({type:"POST",url:e("#url_site").val()+"index.php/pdp/view/saveSampleDesign",data:{json_string:t},beforeSend:function(){},error:function(){console.log("Something went wrong...!")},success:function(t){var n=e.parseJSON(t);if(n.success){alert(n.message)}if(n.error){alert(n.message)}}})})},centerCanvas:function(){var t=e(".wrapper_pdp").width(),n=e(".wrap_inlay_center").width();e(".wrap_inlay_center").css("margin-left",(t-n)/2+"px")},downloadSideImage:function(){e("#download_image").click(function(){var t=e("#temp_action").val("DOWNLOAD");var r=e("#pdp_side_items li.active");var i=JSON.parse(s[r.index()]);var o=document.getElementById("thumbnail_"+r.attr("id").replace("side_",""));f[r.attr("id")]={temp_canvas:null,final_canvas:null,json:i,background:n+"media/pdp/images/"+r.attr("side_img"),inlay_info:e(r).attr("inlay").split(","),final_canvas_width:o.naturalWidth,final_canvas_height:o.naturalHeight};canvasEvents.resetBeforeRender();e("#pdp_side_items li").not(".active").addClass("rendered");canvasEvents.renderSide(r,r.attr("id"),u);l=setTimeout(canvasEvents.isRenderFinished,u)})}()};e("#pdp2_zoom").click(function(){var t=e("#temp_action").val("PREVIEW");var r=e("#pdp_side_items li.active");var i=JSON.parse(s[r.index()]);var o=document.getElementById("thumbnail_"+r.attr("id").replace("side_",""));f[r.attr("id")]={temp_canvas:null,final_canvas:null,json:i,background:n+"media/pdp/images/"+r.attr("side_img"),inlay_info:e(r).attr("inlay").split(","),final_canvas_width:o.naturalWidth,final_canvas_height:o.naturalHeight};canvasEvents.resetBeforeRender();e("#pdp_side_items li").not(".active").addClass("rendered");canvasEvents.renderSide(r,r.attr("id"),u);l=setTimeout(canvasEvents.isRenderFinished,u)});e('#font_color_list li a[rel="000000"]').addClass("active");e(".pdp_design_color").prepend('<li id="pdp_color_ori" name="pdp_color_ori" class="active"></li>');e(".pdp_design_color li").click(function(){e(".pdp_design_color li.active").removeClass("active");e(this).addClass("active");e("#pdp_side_items li").each(function(){var t=e(this).attr("tab"),r=e(".pdp_design_color li.active").attr(t);e(this).attr("side_img",r).children("img").attr("src",n+"media/pdp/images/"+r)});PDPsetting.change_image()});e("#prices_layer tbody").on("click","tr",function(){if(!e(this).hasClass("active")){e(".prices_layer tbody tr.active").removeClass("active");e(this).addClass("active")}canvasEvents.activeobj(e(this).attr("rel"))});var o=e("#pdp_side_items li").length;if(o==1){e("#pdp_rotate_item, #rotate-180").hide()}e("#save_design").click(function(t){e("#temp_action").val("SAVE_ADMIN_TEMPLATE");canvasEvents.save_design2(true)});e("body").on("click","#pdp_share",function(t){e("#temp_action").val("SHARE");canvasEvents.save_design2(true)});setting={color:"#000",border:"#88AFFB",padding:5,cornerSize:8,center_canvas:function(){var t=e(".wrap_pdp_design").width();e(".product-image").each(function(){e(".product-image").hide();e(this).show();var n=e(this).find(".wrap_inlay_center img").width();e(this).find(".wrap_inlay_center").css({"margin-left":(t-n)/2+"px","float":"left"})});e(".product-image:not(.act)").hide();e(".product-image.act").show();canvasEvents.renderall()},first_category:function(){var t=e("#image_category_list li:eq(0) span").text();e(".pdp_selected_category").html(t)},active_slider:function(){e("#h-shadow").noUiSlider({range:[-50,50],start:[0],handles:1,slide:function(){canvasEvents.editShadowItem()}});e("#v-shadow").noUiSlider({range:[-50,50],start:[0],handles:1,slide:function(){canvasEvents.editShadowItem()}});e("#t-blur").noUiSlider({range:[0,50],start:[0],handles:1,slide:function(){canvasEvents.editShadowItem()}});e("#pdp_opacity_input").noUiSlider({range:[0,10],start:[10],handles:1,slide:function(){var t=e(this).val()/10;var n=r.getActiveObject();if(!n)return;n.set("opacity",t);if(n.type=="curvedText"){n.setOpacity(n.text,t)}r.calcOffset().renderAll()},serialization:{}});e("#pdp_opacity_input,#v-shadow,#t-blur,#h-shadow").change(function(){canvasEvents.renderall()});e("#pdp_font_size_input").noUiSlider({range:[1,200],start:[20],handles:1,slide:function(){e("#pdp_font_size_value").html(parseInt(e(this).val())+"px")}});e("#pdp_font_size_input").change(function(){canvasEvents.editText()});e("#font_color").hide().click(function(){e("#font_color_colorpicker").toggle()});e("#font_color_colorpicker_value").click(function(){e("#font_color_colorpicker").toggle()});e("#font_color_colorpicker_value").keyup(function(){var t=e(this).val();e(this).css("background-color",t);canvasEvents.changeTextColor(t)});e("#pdp_edit_text_line_height_input").noUiSlider({range:[1,100],start:[13],handles:1,slide:function(){canvasEvents.editText();e("#pdp_font_line_height_value").html(parseInt(e(this).val())+"px")}});e("#font_outline_colorpicker").farbtastic(function(t){e("#font_outline_color_value").css("background-color",t);canvasEvents.editShadowItem();e("#font_outline_color_value").val(t)});e("#font_color_colorpicker").farbtastic(function(t){e("#font_color").css("color",t);canvasEvents.changeTextColor(t);e("#font_color_colorpicker_value").val(t).css("background-color",t)})}};setting.first_category();setting.active_slider();e(".size_qty, #select_font_size, #h-shadow, #v-shadow, #t-blur").ForceNumericOnly();var c;if(e("#pdp_side_items li.active").length>0){c=e("#pdp_side_items li.active")}else{c=e("#pdp_side_items li:eq(0)")}e("#select_font li").each(function(){e(this).css("font-family",e(this).attr("rel"))});e("#select_font li").click(function(){e("#select_font li.active").removeClass("active");e(this).addClass("active");canvasEvents.editText()});PDPsetting.center_design_area();c.addClass("active");var h=c.attr("inlay").split(",");e("#wrap_inlay").css({width:h[0]+"px",height:h[1]+"px",top:h[2]+"px",left:h[3]+"px"});e("#canvas_area").attr({width:h[0],height:h[1]});r=new fabric.Canvas("canvas_area",{});e("#pdp_side_items li").each(function(){e(".wrapper_pdp").append(e(this).children("img").clone().addClass("pdp_img_session_"+e(this).index()).removeAttr("width").hide());e("#pdp_color_ori").attr(e(this).attr("tab"),e(this).attr("side_img"));s[e(this).index()]=JSON.stringify(r.toJSON(["name","price","tcolor","isrc","icolor","id"]))});var p="";if(e("input[name=pdp_design_string]").length){if(e("input[name=pdp_design_string]").val()!=""){p=JSON.parse(e("input[name=pdp_design_string]").val())}}if(e("#cart_item_id").length){if(e("#cart_item_id").val()!=""||e("#wishlist_item_id").val()!=""){if(e("#extra_options_value").val()){p=JSON.parse(e("#extra_options_value").val())}}}if(p!=""&&p!=undefined){e(".pdp_design_color li.active").removeClass("active");e(".pdp_design_color li["+e("#pdp_side_items li:eq(0)").attr("tab")+'="'+p.items[0].side_img+'"]').addClass("active");for(i=0;i<p.items.length;i++){s[i]=p.items[i].json}}e("#main_image").addClass("loaded");e("#main_image").load(function(){if(e("#main_image").hasClass("loaded")){canvasEvents.load_json(s[0]);e("#wrap_inlay").attr("tab",e("#pdp_side_items li:eq(0)").attr("tab"));e("#main_image").removeClass("loaded");e(".pdp_design_color li.active").click();canvasEvents.addlayer_first_time()}});e("#edit_item_wrap .item").click(function(){e("#edit_item_wrap .item.active").removeClass("active");if(e(this).css("opacity")==1){e(this).toggleClass("active");var t=e(this).attr("tab");e(".pdp_extra_item:not(#"+t+")").slideUp(500);e("#"+t).slideToggle(500)}else{e(".pdp_extra_item").slideUp(500)}});e("#pdp2_curved_text_reverse").click(function(){var t=r.getActiveObject();if(t){t.set("reverse",e(this).is(":checked"));canvasEvents.renderall()}});e("#pdp2_curved_text_radius").noUiSlider({range:[1,200],start:[100],handles:1,slide:function(){e("#pdp2_curved_text_radius_value").val(e(this).val())}});e("#pdp2_curved_text_done").click(function(){var t=e("#pdp2_curved_text").val();var n=r.getActiveObject();if(!n)return;n.setText(t);canvasEvents.editText();canvasEvents.renderall()});e("#pdp2_curved_text_radius_value").ForceNumericOnly();e("#pdp2_curved_text_radius_value").change(function(){e("#pdp2_curved_text_radius").val(e(this).val());canvasEvents.editText()});e("#pdp2_curved_text_spacing").noUiSlider({range:[1,50],start:[15],handles:1,slide:function(){e("#pdp2_curved_text_spacing_value").val(e(this).val())}});e("#pdp2_curved_text_spacing_value").ForceNumericOnly();e("#pdp2_curved_text_spacing_value").change(function(){e("#pdp2_curved_text_spacing").val(e(this).val());canvasEvents.editText()});e("#pdp2_curved_text_radius, #pdp2_curved_text_spacing").change(function(){var t=r.getActiveObject();if(t){if(e(this).attr("id")=="pdp2_curved_text_radius"){t.set("radius",e(this).val())}if(e(this).attr("id")=="pdp2_curved_text_spacing"){t.set("spacing",e(this).val())}canvasEvents.renderall()}});e("#icon_list, #lists_img_upload, #photos_album").on("click","img",function(){var t=e(this).attr("src"),n=t.split("."),i=e(this).width(),s=t.split("/"),o=e(this).attr("image_name"),u=e(this).attr("id"),a=e(this).attr("color_type"),f=e(this).attr("color");himg=e(this).height();if(!e(this).hasClass("added_color")){e(this).addClass("added_color");if(a==2){canvasEvents.makelistcolor(f,u)}}var l=e(this).attr("price");if(l==undefined){var c={};c.clipart_price=0;if(e("#pdc_product_config").length){c=JSON.parse(e("#pdc_product_config").val())}l=c.clipart_price}e("#design_control .tab_content:not(#pdp_rotate_item)").slideUp(200);if(n[n.length-1]!="svg"){fabric.Image.fromURL(t,function(e){var n=d(r.width,r.height,e.width,e.height);e.set({angle:0,price:l,id:u,isrc:t,tcolor:a,icolor:s[s.length-1],width:n.width,height:n.height,padding:setting.padding});e.transparentCorners=true;e.cornerSize=10;e.scale(1).setCoords();r.centerObject(e);r.add(e).setActiveObject(e);canvasEvents.addlayer()})}else{canvasEvents.addSvg(t,e(this).attr("price"),o,a,f,u)}});e("#edit_item_wrap").owlCarousel({items:10,itemsDesktop:[1e3,7],itemsDesktopSmall:[900,4],itemsTablet:[600,2],itemsMobile:[340,1],lazyLoad:true,navigation:true,navigationText:["&#xf053;","&#xf054;"]});e(".add_artwork > a").on("click",function(){e(".tab_content:not(#select_image, #pdp_rotate_item)").slideUp(0);e("#select_image").slideToggle(0)});e(".add_text > a").on("click",function(){e("#add_text").slideToggle(0);e("#font_outline_colorpicker").hide();e(".tab_content:not(#add_text, #pdp_rotate_item), .pdp_extra_item").slideUp(0);e(".pdp_text_list li.active").removeClass("active")});e(".pdp_close").click(function(){e(this).parents(".tab_content").slideUp(0)});e(".pdp_text_list ul li").click(function(){e(".pdp_text_list ul li.active").removeClass("active");e("#add_text_input").val(e(this).text());e(this).addClass("active")});e(".pdp_text_list ul li.active").click(function(){e("#add_text_action").click()});e(".pdp2_close").click(function(){e("#pdp_design_popup").hide()});e("#pdp_side_items li").click(function(){canvasEvents.clearSelected();if(e(this).hasClass("active")){return}e("#pdp_side_items li.active").removeClass("active");e(this).addClass("active");var t=e(this).attr("tab"),n=e("#wrap_inlay").attr("tab"),i=e("#pdp_side_items li[tab="+n+"]").index();if(e(".product-image.act .wrap_inlay_center").attr("tab")!=t){e("#wrap_inlay").attr("tab",t);s[i]=JSON.stringify(r.toJSON(["name","price","tcolor","isrc","icolor","id"]));canvasEvents.reset_canvas(t)}});e("#rotate-180").click(function(){e("#pdp_rotate_item").slideToggle(400);e(".tab_content:not(#pdp_rotate_item)").slideUp(300)});e("#pdp_edit_text_tab a").click(function(){e("#pdp_edit_text_tab a.active").removeClass("active");e(this).addClass("active");e(".pdp_edit_text_tab_content").slideUp(300);e("#"+e(this).attr("tab")).slideDown(400)});e(".pdp_edit_font_style li a.text").click(function(){e(this).toggleClass("active");canvasEvents.editText()});e("#pdp_search_text").keyup(function(){var t=e(this).val().toUpperCase();e(".pdp_text_list li").each(function(){if(e(this).text().toUpperCase().indexOf(t)>=0){e(this).show()}else{e(this).hide()}})});e("#pdp_edit_text_style li a.align").click(function(){e("#pdp_edit_text_style li a.align.active").removeClass("active");e(this).addClass("active");canvasEvents.editText()});e("#pdp_font_size_value").ForceNumericOnly();e("#pdp_font_size_value").change(function(){e("#pdp_font_size_input").val(e(this).val());var t=r.getActiveObject();if(!t)return;canvasEvents.editText()});e(".wrapper_pdp .product-image").click(function(){e(".wrapper_pdp .product-image.act").removeClass("act");e(this).addClass("act")});e(".tshirt-size input").change(function(){if(e(this).val()==""||e(this).val()<0){e(this).val(0)}e(this).val(parseInt(e(this).val()))});e("#design_control .control_tab .tab_main").click(function(){var t=e(this).attr("tab");e("#design_control .control_tab .tab_main.active").removeClass("active");e(this).addClass("active");e("."+t).show()});e(".tab_design_image a").click(function(){e(".tab_design_image .active").removeClass("active");e(this).addClass("active");var t=e(this).attr("tab-content");e(".content_tab > div").hide();e(".content_tab ."+t).show()});e("#add_text_action").click(function(){var t=e("#add_text_input").val(),n=e(".pdp_text_list li.active").text();if(n!=""){canvasEvents.addText(n)}else{if(t!=""){canvasEvents.addText(t)}}});e("#add_text_curved_action").click(function(){var t=e("#add_text_input").val(),n=e(".pdp_text_list li.active").text();if(n!=""){canvasEvents.addTextCurved(n)}else{if(t!=""){canvasEvents.addTextCurved(t)}}});e("#use_shadow").click(function(){if(!e(this).hasClass("active")){e(".font_outline_color > div").show();canvasEvents.addShadowItem();e(this).addClass("active")}else{e(".font_outline_color > div:not(.use_shadow)").hide();canvasEvents.removeShadow();e(this).removeClass("active")}e("#font_outline_colorpicker").hide()});e(".change_font .next_t").click(function(){var t=e(this).prev().val();e(this).prev().val(parseInt(t)+1);canvasEvents.editText()});e(".change_font .prev_t").click(function(){var t=e(this).next().val();if(e(this).next().attr("id")=="t-blur"&&t==0){}else{if(e(this).next().attr("id")=="select_font_size"&&t<3){}else{e(this).next().val(parseInt(t)-1)}}canvasEvents.editText()});e("#pdp_edit_text_input").keyup(function(){canvasEvents.editText()});e("#image_category_list, #select_image").show();var v=e("#image_category_list").height();e("#image_category_list, #select_image").hide();e(".design_label").click(function(){e("#image_category_list").slideToggle(0)});e("#font_outline_color").click(function(){e("#font_outline_colorpicker").slideToggle(300)});e(".inlay_div.color, .color_content_wrap .bt_done").click(function(){e(".color_content").hide();e("#pdp_color_text").removeClass("pdp_cr_color");e(".color_display").removeClass("act")});e("#pdp_color_text li a").click(function(){e("#pdp_color_text li a.active").removeClass("active");e(this).addClass("active");var t=e(this).css("background-color");canvasEvents.changeColor(t)});e("#pdp_color_item li a").click(function(){e("#pdp_color_item li a.active").removeClass("active");e(this).addClass("active");var t=e(this).css("background-color");canvasEvents.changeColor(t)});e(".color_content li a:not(.selected_color, .bt_done)").click(function(){e(".color_content li a.act").removeClass("act");e(this).addClass("act");var n;if(e(this).hasClass("pdp_color_ori")){n="ori";e("#selected_color").val("");e(".color_display.act").css("background-color","#FFF")}else{n=e(this).css("background-color");e("#selected_color").val(t(n));e(".color_display.act").css("background-color",n)}e("a.selected_color").css("background-color",n);var i=r.getActiveObject();if(!i)return;if(e("#pdp_color_text").hasClass("pdp_cr_color")){e("#pdp_color_text input").val(t(n))}if(i.text){canvasEvents.editText()}if(e("#use_shadow").hasClass("active")){canvasEvents.editShadowItem();canvasEvents.renderall()}if(e("#color_item").hasClass("active")){canvasEvents.changeColor(n)}});e("#selected_color").change(function(){e("a.selected_color").css("background-color","#"+e(this).val())});var g=e("#send-backwards");g.on("click",function(e){var t=e.getActiveObject();if(t){e.sendBackwards(t)}});var y=e("#send-to-back");y.on("click",function(e){var t=e.getActiveObject();if(t){e.sendToBack(t)}});var b=e("#bring-forward");b.on("click",function(e){var t=e.getActiveObject();if(t){e.bringForward(t)}});var w=e("#bring-to-front");w.on("click",function(e){var t=e.getActiveObject();if(t){e.bringToFront(t)}});var y=e("#move_to_back");y.on("click",function(){var e=r.getActiveObject();if(e){r.sendToBack(e)}});var b=e("#move_to_front");b.on("click",function(){var e=r.getActiveObject();if(e){r.bringForward(e)}});e("#pdp_flip_x").on("click",canvasEvents.flipX);e("#pdp_flip_y").on("click",canvasEvents.flipY);e("#delete_item").on("click",canvasEvents.removeObject);e("#pdp_toolbox").on("click",".item_delete",canvasEvents.removeObject);e("#duplicate_item").on("click",canvasEvents.copyObject);e("html").on("click",function(t){var n=e("#pdp_info_item, #canvas-container, #select_image, #add_text, #canvas_area, .pdp_extra_item, #pdp_opacity_item, .color_content, .control_tab, .canvas-container,#pdp_toolbox, .edit_area , #add_text, .p_rotate_wrap > div, .control_area, #edit_item_wrap").has(t.target).length;if(n===0){canvasEvents.clearSelected()}var r=e("#font_outline_colorpicker, #font_outline_color").has(t.target).length;if(r===0){e("#font_outline_colorpicker").slideUp(200)}var r=e("#font_color_colorpicker, #font_color, .pdp_color_list").has(t.target).length;if(r===0){e("#font_color_colorpicker").slideUp(200)}});r.observe("object:selected",canvasEvents.objectSelected);r.observe("object:modified",canvasEvents.renderall);r.observe("object:modified",canvasEvents.showinfo);r.observe("object:added",canvasEvents.renderall);r.observe("before:selection:cleared",canvasEvents.objectUnselected);e(window).on("keydown",function(t){var n=t.keyCode||t.which;if(n==37){canvasEvents.moveObject("left");return false}else if(n==38){canvasEvents.moveObject("up");return false}else if(n==39){canvasEvents.moveObject("right");return false}else if(n==40){canvasEvents.moveObject("down");return false}else if(n==46){var r=e("#pdp_edit_text_input").is(":focus");if(!r){canvasEvents.removeObject()}return false}});var E=e("#extra_options_value").val();if(e("#cart_item_id").val()==""&&e("#wishlist_item_id").val()==""){if(e("input[name='pdp_design_string']").length){if(e("input[name='pdp_design_string']").val()!=""){E=e("input[name='pdp_design_string']").val()}}}c.addClass("active");if(E!=""&&E!==undefined){var S=JSON.parse(E);if(S.length>0){for(i=0;i<S.length;i++){e("#pdp_info_"+S[i].name).val(S[i].json);e(".design-color-image li#"+S[i].color).click()}}}else{PDPsetting.save_first_design()}PDPsetting.change_side()},init_cr_item:function(){if(e(".wrap_inlay .item").length>0){if(e(".design-color-image li.active").length>0){e(".design-color-image li.active").click()}else{e("#list_color li.active").click()}e(".wrap_inlay .item").each(function(){PDPsetting.init_design(e(this))})}},init_design:function(e){},hideShareButtons:function(){var t;e("body").on("click",".wrap_pdp_design",function(n){t=e(n.target).attr("class");if(t){if(t.match("pdp_share_buttons")||t.match("at300bs")){return false}else{}}e(".pdp_share_buttons").hide()})}()}})